
{% extends 'base.html' %}
{% load static %}
{% block title %} Search rentals {% endblock %}

{% block header %}
    <header class="header">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <div>
                <a href="{% url 'my-profile' user %}">
                    <img style="width: 3em; height: 3em; object-fit: cover;" class="d-inline-block rounded-circle" src="{{user.profile.image.url}}" alt="profile picture" />
                </a>
                <a href="{% url 'my-profile' user %}" class="navbar-brand d-inline-block text-primary">{{user}}</a>
            </div>

            <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav">
                    <a href="{% url 'home-page' %}" class="nav-item nav-link active">Home</a>
                    <a href="{% url 'people-with-rooms' %}" class="nav-item nav-link">People with rentals</a>
                    <a href="{% url 'availabe-rentals' %}" class="nav-item nav-link">Available rentals</a>
                    <a href="{% url 'post-rental' %}" class="nav-item nav-link">Post A room</a>
                    <a href="{% url 'my-profile' user %}" class="nav-item nav-link">My Profile</a>
                </div>
                <div class="navbar-nav ms-auto">
                    <a href="{% url 'u_sure_u_wanna_logout' %}" class="nav-item nav-link">Logout</a>
                </div>
            </div>
        </div>
    </nav>
</header>
{% endblock %}

{% block body %}
<form method="post" style="transform: scale(1.2);" action="{% url 'search' %}">
	{% csrf_token %}
	<div class="form-group">
		<label for="search"></label>
		<input class="search-input mb-4" type="text" name="search-rentals" placeholder="search..place, price, etc.">
	</div>
</form>

{% if searched %}
    <h3 class="text-center text-light mb-4">Showing results for <span class="text-success">{{ searched }}</span></h3>
{% endif %}

{% if rentals %}
	<div class="rentals-container container mt-5">
	{% if rentals %}
            <div class="row">
                {% for rental in rentals %}
                    <div class="col-12 col-sm-6 col-md-4 mb-4">
                        <div class="card bg-dark text-light shadow-lg h-100 rounded-4 overflow-hidden">
                            <a href="{{rental.image.url}}"><img src="{{ rental.image.url }}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="rental image" /></a>
                            <div class="card-body">
                                <h4 class="card-title text-white fw-bold">{{ rental.address }}</h4>
                                <p class="card-text text-light opacity-75" style="font-size: .9rem; color: #afafaf">{{ rental.details|truncatewords:15 }}<a href="{% url 'rental' rental.id %}" style="font-weight: bold">View more</a></p>
                            </div>
                            <div class="card-body border-top border-secondary d-flex justify-content-between align-items-center">
                                <p class="fs-4 text-success mb-0">R{{ rental.price }} pm</p>
                                {% if rental.is_occupied %}
                                <p class="fs-6 text-warning mb-0">OCCUPIED</p>
                                {% endif %}
                                
                                <a href="{% url 'rental' rental.id %}" class="btn btn-outline-secondary btn-sm">See</a>
                            </div>
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <a href="{% url 'my-profile' rental.user.username %}" class="text-decoration-none text-light d-flex align-items-center gap-2">
                                    <img src="{{ rental.user.profile.image.url }}" class="rounded-circle" style="width: 2em;" alt="Profile picture" />
                                    <span>{{ rental.user.username }}</span>
                                </a>
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="profile_id" value="{{ rental.user.profile.id }}" />
                                    {% if profile in rental.user.profile.followed_by.all %}
                                        <button class="btn btn-success w-100" name="follow" value="unfollow" type="submit">Unfollow</button>
                                    {% else %}
                                        <button class="btn btn-outline-primary w-100" name="follow" value="follow" type="submit">Follow</button>
                                    {% endif %}
                                </form>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center text-light my-5">
                <h2 class="mb-3">Not found</h2>
                <p class="fs-5">
                    Apparently we did not find a rental that matches your query<br><br><br><br><br><br><br><br><br><br><br><br><br><br>
                </p>
            </div>
            <br><br><br><br><br><br><br><br><br><br>
        {% endif %}
    </div>
{% elif profiles %}
	{% if profiles %}
	    <div class="d-flex flex-wrap justify-content-center gap-4">
	    {% for landlord in profiles %}
	    	{% if landlord.user.rental_set.count > 0 %}
		        <div class="card bg-dark-gradient text-light landlord-card shadow-sm p-3 hovermation" style="max-width: 400px;">
		            <a href="{% url 'my-profile' landlord.user.username %}" class="text-decoration-none text-light">
		                <div class="d-flex align-items-center mb-3">
		                    <img
		                        src="{{landlord.user.profile.image.url}}"
		                        alt="profile"
		                        class="rounded-circle me-3"
		                        style="width: 80px; height: 80px; object-fit: cover"
		                    />
		                    <div>
		                        <h5 class="mb-1">{{ landlord.user.username }}</h5>
		                        <p class="opacity-75 mb-0">{{ landlord.user.profile.address }}</p>
		                    </div>
		                </div>
		            </a>

		            <div class="d-flex justify-content-between text-center border-top pt-3">
		                <div>
		                    <p class="mb-0 fw-bold">{{ landlord.user.profile.followed_by.count }}</p>
		                    <small class="opacity-50 text-light">Followers</small>
		                </div>
		                <div>
		                    <p class="mb-0 fw-bold">{{ landlord.user.rental_set.count }}</p>
		                    <small class="opacity-50">Rentals</small>
		                </div>
		                <div>
		                    <form method="post" action="{% url 'people-with-rooms' %}">
		                        {% csrf_token %}
		                        <input type="hidden" name="profile_id" value="{{ landlord.user.profile.id }}">
		                        {% if profile in landlord.follows.all %}
		                            <button style="width: 8em" class="mb-3 btn btn-success" name="follow" value="unfollow" type="submit">Unfollow</button>
		                        {% else %}
		                            <button style="width: 8em" class="mb-3 btn btn-outline-primary" name="follow" value="follow" type="submit">Follow</button>
		                        {% endif %}
		                    </form>
		                </div>
		            </div>
		        </div>
		    {% endif %}
	    {% endfor %}
	    </div>
	{% else %}
	    <h1 class="text-center text-light">Eish.. <span class="text-danger">no one</span> has posted rooms at the moment</h1>
	    <br />
	    <h3 class="text-center text-light">
	        If you have a room <a href="{% url 'post-rental' %}" class="btn btn-success">Post one</a>
	    </h3>
	    <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
	{% endif %}
{% elif searched %}
	<br><br><br><br><br>
    <h2 class="text-center text-light"><span class="text-warning">No results</span> found for "<span class="text-primary">{{ searched }}</span>"</h2>
    <br><br><br><br><br>
{% else %}
	<br><br><br><br><br>
    <h1 class="text-center text-light display-1">Whatchu lookin' for?</h1>
    <br><br><br><br><br>
{% endif %}


{% endblock %}